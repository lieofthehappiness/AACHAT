<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fill Table</title>
    <style>
      table {
        border-collapse: collapse;
      }

      table,
      th,
      td {
        border: 1px solid black;
        cursor: pointer;
      }

      th,
      td {
        padding: 10px;
      }
    </style>
  </head>
  <body>
    <div id="tableSize">
      <label for="rows">Rows:</label>
      <input type="number" id="num-rows" />
      <label for="cols">Columns:</label>
      <input type="number" id="num-cols" />
      <button onclick="createInputTableTo('table-container')">
        Create Table
      </button>
    </div>
    <div id="interface1">
      <h2>Enter Teammate Information</h2>
      <label for="teammateName">Teammate Name:</label>
      <input type="text" id="teammateName" />
      <br />
      <p>Blocked Cells:</p>

      <div id="table-container"></div>

      <button onclick="addTeammate()">Add Teammate</button>
    </div>
    <div id="interface3" style="display: none">
      <h2>Filled Table</h2>
      <button onclick="fillTable()">Fill Table</button>
      <button onclick="generatePDF()">Generate PDF</button>
      <button onclick="showRandomResult()">Show Random Result</button>
      <table id="table"></table>
    </div>

    <script>
      let teammates = [];
      let blockedCells = [];
      let tableData = [];
      let currentSelectedCells = [];

      function createInputTableTo(id) {
        const tableContainer = document.getElementById(id);
        if (tableContainer.firstChild) {
          tableContainer.removeChild(tableContainer.firstChild);
        }

        const numRows = parseInt(document.getElementById("num-rows").value);
        const numCols = parseInt(document.getElementById("num-cols").value);

        if (numRows <= 0 || numCols <= 0) {
          alert("請輸入正整數");
          return;
        }

        const table = document.createElement("table");
        table.id = "teammate-table";

        const tableBody = document.createElement("tbody");

        for (let i = 0; i < numRows; i++) {
          const row = document.createElement("tr");

          for (let j = 0; j < numCols; j++) {
            const cell = document.createElement("td");
            cell.onclick = function () {
              if (!currentSelectedCells.includes(cell)) {
                currentSelectedCells.push([
                  cell.cellIndex,
                  cell.parentElement.rowIndex,
                ]);
                cell.style.backgroundColor = "red";
              }
            };

            row.appendChild(cell);
          }

          tableBody.appendChild(row);
        }

        table.appendChild(tableBody);

        document.getElementById(id).appendChild(table);
      }

      function addTeammate() {
        const name = document.getElementById("teammateName").value;
        const blocked = currentSelectedCells;
        // get the selected cells and set the backgroundColor to white
        currentSelectedCells.forEach((cell) => {
          const [col, row] = cell;
          const table = document.getElementById("teammate-table");
          table.rows[row].cells[col].style.backgroundColor = "white";
        });

        currentSelectedCells = [];
        teammates.push({ name, blocked });
        console.log(teammates);
        document.getElementById("teammateName").value = "";//清空input
         document.getElementById("teammateName").innerHTML = "";//清空畫面文字
      }
      function highlightBlockedCells(name) {
        const teammate = teammates.find(t => t.name === name);
        if (teammate) {
            teammate.blocked.forEach(cell => {
                const [col, row] = cell;
                const table = document.getElementById("teammate-table");
                table.rows[row].cells[col].style.backgroundColor = "grey";
            });
        }
    }

      function fillTable() {
        // waitting for implementation
      }

      function generatePDF() {
        // Code to generate PDF from tableData
        console.log("PDF Generated");
      }

      function showRandomResult() {
        // to be continue
      }

    </script>
  </body>
</html>