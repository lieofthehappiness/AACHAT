
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="./node_modules/jspdf/dist/jspdf.umd.min.js"></script>
    <script src="./node_modules/html2canvas/dist/html2canvas.min.js"></script>
    <script src="./foldervreater.js"></script>
    <script src="./clearthecolorer.js"></script>
    <script src="./Teammateadder.js"></script>
    <script src="./awaysblocker.js"></script>
    <script src="./tablecreater.js"></script>
    <script src="./generater.js"></script>
    <script src="./generateUniqueColorer.js"></script>
    <script src="./endingofthegrouper.js"></script>
    <title>Fill Table</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body background="picture1.png">
<!--nwrjgb2pirbg2pirbgp2ib2piub2pi4ubp2ibvpjvfnvs-->
<div id="00">
    <div id="folderCreation">
        <input type="text" id="folderName" placeholder="Enter folder name">
        <button onclick="createFolder()">Create Folder</button>
    </div>
    <div id="tableSize" class="hidden">
        <label for="rows">Rows:</label>
        <input type="number" id="num-rows" min="1" value="1" />
        <label for="cols">Columns:</label>
        <input type="number" id="num-cols" min="1" value="1"/>
        <button onclick="createInputTableTo('table-container')">
            Create Table
        </button>
    </div>
</div>
<!--nwrjgb2pirbg2pirbgp2ib2piub2pi4ubp2ibvpjvfnvs-->
<div id="selectthegroup" class="hidden">
    <h2>select the group</h2>
    <button id="startGrouping">start a new group</button>
    <button id="confirmGroup">check</button>
    <button onclick="endingofthegroup()" id="endingofG">next step</button>
</div>

<!--nwrjgb2pirbg2pirbgp2ib2piub2pi4ubp2ibvpjvfnvs-->
<div id="interface1" class="hidden">
    <h2>Enter Teammate Information</h2>
    <label for="teammateName">Teammate Name:</label>
    <input type="text" id="teammateName" />
    <h3>班數的上限與下限</h3> 
    <label for="inputX">lower limit:</label>
    <input type="number" id="inputX" name="inputX" min="0" value="0">
    <label for="inputY">upper limit:</label>
    <input type="number" id="inputY" name="inputY" min="1" value="1">
    <button id="toggleButton" >going to select the blocked</button>
    <button class="hidden" id="adding_teammates">add teammates</button>
    <br />
    <p>Blocked Cells:</p>
</div>
<div id="table-container"></div>
<div id="showthepeople">
    <h2>your teamates</h2>
    <div id="teammate-list"></div>
</div>

<div id="clearweirdcolor">
<button onclick="clearthecolor()" class="hidden" id="alittlebutton">clear the color</button>
</div>

<div id="interface3"  class="hidden">
    <h2>Filled Table</h2>
    <button onclick="blobloblo()">Fill Table</button>
    <button onclick="showRandomResult()">Show Random Result</button>
    <table id="table"></table>
</div>


<script>

//////
let grouping = false;//選時間段用
let selectedCells = [];
let donottouchcells=[];
let usedColors = ["#FFFFFF"];//記得改//記得改得//記得改//記得改//記得改//記得改//記得改記得改
let currentColor = "";
let timegroup=[];
///////////////////////////////////
let isToggling=false; //選block用
let teammates = [];//
let blockedCells = [];
let tableData = [];
let awaysblockcell=[];
let currentSelectedCells = [];
////////////////////
let numRows;
let numCols;    
let shiftd;
let shiftu;

/////////////
document.getElementById("startGrouping").addEventListener("click", function() {
    grouping = true;
    selectedCells = [];
    currentColor = generateUniqueColor();
    document.getElementById('confirmGroup').style.display = 'block'; 
    document.getElementById('startGrouping').style.display = 'none';
    document.getElementById('endingofG').style.display = 'none';
  //  usedColors.push(currentColor);
})
let iiii=0;
document.getElementById("confirmGroup").addEventListener("click", function() {
    grouping = false;
    document.getElementById('confirmGroup').style.display = 'none'; 
    document.getElementById('startGrouping').style.display = 'block';
    document.getElementById('endingofG').style.display = 'block';
    timegroup.push({selectedCells,iiii});
    donottouchcells.push.apply(donottouchcells,selectedCells);
    iiii++;
    selectedCells = [];
});
///////////
document.getElementById("toggleButton").addEventListener("click", function() {
    const nameInput = document.getElementById("teammateName");
    const name = nameInput.value;
    if (!name) {
         alert("請輸入隊友名稱");
        return;
     }
    document.getElementById('adding_teammates').style.display = 'block'; 
    isToggling=true;
   // console.log(isToggling);
    document.getElementById('toggleButton').style.display = 'none';
});
///////////////////////////////////////////////////
document.getElementById("adding_teammates").addEventListener("click", function() {
    const nameInput = document.getElementById("teammateName");
        isToggling=false;
        document.getElementById('toggleButton').style.display='block'; 
        document.getElementById('interface3').style.display='block'; 
        document.getElementById('adding_teammates').style.display='none'; 
        const name = nameInput.value;
        shiftd=document.getElementById("inputX").value;
        shiftu=document.getElementById("inputY").value;
        let shiftnow=0;
        // get the selected cells and set the backgroundColor to white
        currentSelectedCells.forEach((cell) => {
            cell.style.backgroundColor = "";
        });
        const blocked = currentSelectedCells;
        currentSelectedCells = [];
        teammates.push({ name, blocked ,shiftd,shiftu,shiftnow});
      //  console.log(teammates);
      //  console.log(typeof teammates[0].blocked[0]);
        // Clear teammate name input
        nameInput.value = "";
        // Update teammate list
         document.getElementById("teammateName").value = "";//清空input
         document.getElementById("teammateName").innerHTML = "";//清空畫面文字
        updateTeammateList();

});
////////////////////////////////////////////




    function updateTeammateList() {
        const abutton=document.getElementById("alittlebutton");
        abutton.style.display="block";
        const teammateListContainer = document.getElementById("teammate-list");
        teammateListContainer.innerHTML = ""; // Clear previous list
        teammates.forEach((teammate, index) => {
            const teammateNameElement = document.createElement("div");
            teammateNameElement.classList.add("teammate-name");
            teammateNameElement.textContent ="name:"+teammate.name+" shift:"+teammate.shiftd+"\~"+teammate.shiftu;
            teammateNameElement.onclick = function () {
                // Highlight blocked cells
                highlightBlockedCells(teammate.blocked);
            };
            teammateListContainer.appendChild(teammateNameElement);
        });
    }
    function highlightBlockedCells(blockedCells) {
        const table = document.getElementById("teammate-table");
        table.querySelectorAll("td").forEach((cell) => {
            cell.style.backgroundColor = ""; // Reset background color
        });
        blockedCells.forEach((cell) => {
            cell.style.backgroundColor="gray";
        })
     //   blockedCells.forEach(([row, col]) => {
           // table.rows[row].cells[col].style.backgroundColor = "gray";
       // });
    }

function fillTable(x,y) {
    const table = document.getElementById("teammate-table");
    const cell = table.rows[x].cells[y];
    
    var isPresent = awaysblockcell.includes(cell);
    if(isPresent) {
        if(y<numCols-1) fillTable (x,y+1);
        else if (x<numRows-1) fillTable(x + 1, 0);
        else if (x ===numRows-1 && y === numCols-1) {
            generate();
        }
    }
    else {
        for(let i=0;i<teammates.length;i++) {
            w=true;
            if(teammates[i].shiftnow>=teammates[i].shiftu) {
                w=false;
                continue;
            } 
            w=(w&&!teammates[i].blocked.includes(cell));
            if(w) {
            //   console.log([cell.cellIndex, cell.parentElement.rowIndex]);  
                cell.innerHTML=teammates[i].name;
                teammates[i].shiftnow++;
                if(y<numCols-1) fillTable (x,y+1);
                else if (x<numRows-1) fillTable(x + 1, 0);
                else if (x ===numRows-1 && y === numCols-1) {
                    generate();
                }
            teammates[i].shiftnow--;
            }
            cell.innerHTML=""; 
        }
    }


}
    function showRandomResult() {
        fetch('/showtheresult', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Failed to show.');
            }
            return response.text();
        })
        .then(data => {
            document.getElementById("table").innerHTML = data;
        })
        .catch(error => {
            console.error(error);
            console.log('Failed to showw.');
        });
    }
</script>
</body>
</html>



